<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Site Master Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<style>
  body { font-family: 'Segoe UI', sans-serif; margin: 0; background: #f4f6f8; color: #333; }
  header { background: #2c3e50; color: white; padding: 1em; text-align: center; }
  
  .stats {
    display: flex; gap: 20px; justify-content: center; margin: 20px; flex-wrap: wrap;
  }
  .stat-card {
    background: white; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    padding: 15px 25px; text-align: center; min-width: 150px;
  }
  .stat-value { font-size: 1.6em; font-weight: bold; color: #3498db; }
  .stat-label { font-size: 0.9em; color: #777; }

  .controls {
    display: flex; gap: 10px; justify-content: center; margin: 1em; flex-wrap: wrap;
  }
  button {
    padding: 0.5em 1.2em; border: none; background: #3498db; color: white;
    cursor: pointer; border-radius: 4px; font-weight: 500;
  }
  button:hover { background: #2980b9; }

  .charts {
    display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; margin: 2em;
  }
  .chart-card {
    background: white; border-radius: 8px; padding: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    width: 300px;
  }
  .chart-card h3 { text-align: center; font-size: 1em; margin-bottom: 10px; color: #555; }

  table {
    width: 100%; border-collapse: collapse; background: white; margin-top: 1em;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  }
  th, td {
    border: 1px solid #ddd; padding: 8px; text-align: center; font-size: 0.9em;
  }
  th {
    background: #34495e; color: white; position: sticky; top: 0; z-index: 1;
  }
  tbody tr:nth-child(even) { background-color: #f9f9f9; }
  tbody tr:hover { background-color: #eaf2f8; }
</style>
</head>
<body>
<header>
  <h1>ðŸ“Š Site Master Dashboard</h1>
</header>

<div class="stats">
  <div class="stat-card">
    <div class="stat-value" id="totalSites">0</div>
    <div class="stat-label">Total Sites</div>
  </div>
  <div class="stat-card">
    <div class="stat-value" id="upgradePercent">0%</div>
    <div class="stat-label">Requires Upgrade</div>
  </div>
  <div class="stat-card">
    <div class="stat-value" id="hardwarePercent">0%</div>
    <div class="stat-label">Hardware Offloaded</div>
  </div>
</div>

<div class="controls">
  <input type="file" id="fileInput" accept=".csv,.xlsx" style="display:none;">
  <button onclick="document.getElementById('fileInput').click()">Import</button>
  <button onclick="exportTable()">Export CSV</button>
  <button onclick="downloadTemplate()">Download Template</button>
</div>

<div class="charts">
  <div class="chart-card">
    <h3>Inbound Connection Types</h3>
    <canvas id="inboundChart" width="280" height="280"></canvas>
  </div>
  <div class="chart-card">
    <h3>Upgrade Requirement</h3>
    <canvas id="upgradeChart" width="280" height="280"></canvas>
  </div>
  <div class="chart-card">
    <h3>Hardware Offloaded</h3>
    <canvas id="hardwareChart" width="280" height="280"></canvas>
  </div>
</div>

<div style="overflow-x:auto; margin:20px;">
  <table id="siteTable">
    <thead>
      <tr>
        <th>Site Name</th>
        <th>Requires Upgrade</th>
        <th>Clients</th>
        <th>Inbound Connection</th>
        <th>Hardware Offloaded</th>
        <th>Mains Power</th>
        <th>Mains Monitor</th>
        <th>Backup 5ghz</th>
        <th>Notes</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
let tableData = [];

function renderTable() {
  const tbody = document.querySelector('#siteTable tbody');
  tbody.innerHTML = '';
  tableData.forEach(row => {
    const tr = document.createElement('tr');
    row.forEach(cell => {
      const td = document.createElement('td');
      td.textContent = cell;
      tr.appendChild(td);
    });
    tbody.appendChild(tr);
  });
  updateCharts();
  updateStats();
}

function updateStats() {
  const total = tableData.length;
  const upgrades = tableData.filter(r => r[1] && r[1].toString().toLowerCase() === 'true').length;
  const hardware = tableData.filter(r => r[4] && r[4].toString().toLowerCase() === 'true').length;

  document.getElementById('totalSites').textContent = total;
  document.getElementById('upgradePercent').textContent = total ? Math.round((upgrades / total) * 100) + '%' : '0%';
  document.getElementById('hardwarePercent').textContent = total ? Math.round((hardware / total) * 100) + '%' : '0%';
}

function updateCharts() {
  const inboundCounts = {};
  const upgradeCounts = { TRUE: 0, FALSE: 0 };
  const hardwareCounts = { TRUE: 0, FALSE: 0 };

  tableData.forEach(row => {
    inboundCounts[row[3]] = (inboundCounts[row[3]] || 0) + 1;
    const upgradeKey = String(row[1]).toLowerCase() === 'true' ? 'TRUE' : 'FALSE';
    const hardwareKey = String(row[4]).toLowerCase() === 'true' ? 'TRUE' : 'FALSE';
    upgradeCounts[upgradeKey] = (upgradeCounts[upgradeKey] || 0) + 1;
    hardwareCounts[hardwareKey] = (hardwareCounts[hardwareKey] || 0) + 1;
  });

  new Chart(document.getElementById('inboundChart'), {
    type: 'pie',
    data: { labels: Object.keys(inboundCounts),
            datasets: [{ data: Object.values(inboundCounts), backgroundColor: ['#3498db','#e67e22','#2ecc71','#9b59b6','#f1c40f'] }] },
    options: { plugins: { legend: { position: 'bottom' } } }
  });

  new Chart(document.getElementById('upgradeChart'), {
    type: 'doughnut',
    data: { labels: ['Requires Upgrade', 'No Upgrade'],
            datasets: [{ data: [upgradeCounts.TRUE, upgradeCounts.FALSE], backgroundColor: ['#e74c3c','#2ecc71'] }] },
    options: { plugins: { legend: { position: 'bottom' } } }
  });

  new Chart(document.getElementById('hardwareChart'), {
    type: 'bar',
    data: { labels: ['TRUE', 'FALSE'],
            datasets: [{ label: 'Hardware Offloaded', data: [hardwareCounts.TRUE, hardwareCounts.FALSE], backgroundColor: ['#2ecc71','#e74c3c'] }] },
    options: { plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
  });
}

document.getElementById('fileInput').addEventListener('change', function(e) {
  const file = e.target.files[0];
  const reader = new FileReader();
  reader.onload = function(e) {
    const data = new Uint8Array(e.target.result);
    const workbook = XLSX.read(data, { type: 'array' });
    const sheetName = workbook.SheetNames[0];
    const sheet = workbook.Sheets[sheetName];
    const json = XLSX.utils.sheet_to_json(sheet, { header: 1 });
    tableData = json.slice(1).filter(row => row.length > 0);
    renderTable();
  };
  reader.readAsArrayBuffer(file);
});

function exportTable() {
  const ws = XLSX.utils.aoa_to_sheet([['Site Name','Requires Upgrade','Clients','Inbound Connection','Hardware Offloaded','Mains Power','Mains Monitor','Backup 5ghz','Notes'], ...tableData]);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, 'Sites');
  XLSX.writeFile(wb, 'sites_export.xlsx');
}

function downloadTemplate() {
  const ws = XLSX.utils.aoa_to_sheet([['Site Name','Requires Upgrade','Clients','Inbound Connection','Hardware Offloaded','Mains Power','Mains Monitor','Backup 5ghz','Notes']]);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, 'Template');
  XLSX.writeFile(wb, 'sites_template.xlsx');
}
</script>
</body>
</html>
